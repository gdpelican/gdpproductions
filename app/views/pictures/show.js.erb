var _activeSquare = $('.activeSquare');
var _fullImage = _activeSquare.find('.fullImage');

var _displayFullImage = function() {
	_fullImage = _activeSquare.find('.fullImage');
	_activeSquare.animate({width: '44.5em'}, 'slow')
				 .animate({height: _getImageHeight(_fullImage) + 30 }, 'slow', function() {
				 _fullImage.closest('.scroller').data('jsp').reinitialise();
				 _fullImage.fadeIn('fast');
	});
}

var _getImageHeight = function(el) {
	el.css({visibility: 'hidden', display: 'block'});
	var height = el.find('img').height();
	el.css({visibility: 'visible', display: 'none'});
	return height;
}

if(!_fullImage.length) {
	_activeSquare.append('<%= escape_javascript(render partial: 'picture_data', locals: { picture: picture }) %>');
	_fullImage = _activeSquare.find('.fullImage');
	_fullImage.find('img').on('load', _displayFullImage);
}	
else
	_displayFullImage();